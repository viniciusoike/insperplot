---
title: "Getting Started with insperplot"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with insperplot}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 9,
  fig.height = 6,
  dpi = 150,
  warning = FALSE,
  message = FALSE
)

# Load Insper fonts for vignette rendering
# Suppresses output to keep vignette clean
suppressMessages(suppressWarnings({
  insperplot::import_insper_fonts(verbose = FALSE)
}))
```

## Introduction

**insperplot** extends ggplot2 with Insper Instituto de Ensino e Pesquisa's visual identity, providing custom themes, color palettes, and specialized plotting functions for academic and institutional use.

This vignette demonstrates all the main features of insperplot using real-world Brazilian data: São Paulo Metro Line-4 ridership during the COVID-19 pandemic.

### Installation

```{r eval=FALSE}
# Install from GitHub
pak::pak("viniciusreginatto/insperplot")
```

```{r setup}
library(insperplot)
library(ggplot2)
library(dplyr)
```

## Font Setup (Optional but Recommended)

insperplot uses fonts based on Insper's official template: **GT Ultra Fine Bold** and **Georgia** (primary for titles), **Inter** and **Arial** (for body text). **EB Garamond** and **Playfair Display** are used as fallbacks for titles. While optional, installing these fonts significantly enhances plot aesthetics.

```{r eval=FALSE}
# Check if recommended fonts are installed
check_insper_fonts()
```

**Installation instructions:**

1. Visit [Google Fonts](https://fonts.google.com)
2. Download "Inter", "EB Garamond", and "Playfair Display"
3. Install on your system
4. Restart R/RStudio

Note: Georgia is typically pre-installed on most systems. GT Ultra Fine is a proprietary font and not available for free. If fonts are unavailable, plots will use system defaults.

## The Dataset: São Paulo Metro Line-4

We'll use ridership data from Line-4 (Yellow Line) of São Paulo's metro system, covering 2018-2020. This dataset captures the impact of COVID-19 lockdowns on public transportation.

```{r load-data}
# Load the metro dataset
data("spo_metro")

# Preview the data
head(spo_metro, 10)
```

The dataset contains:
- **date**: month of observation
- **year**: Year (2018-2020)
- **name_station**: station name
- **value**: average business day ridership in thousands of passengers

## Basic Usage: theme_insper()

The foundation of insperplot is `theme_insper()`, which applies Insper's visual identity to any plot.

```{r basic-theme}
# Standard ggplot2
paulista <- subset(spo_metro, name_station == "Paulista")

# With theme_insper()
ggplot(paulista, aes(x = date, y = value)) +
  geom_line(color = show_insper_colors("teals1"), linewidth = 0.8) +
  theme_insper() +
  labs(
    title = "The Covid-19 Lockdown Impacts on Paulista Station",
    subtitle = "Average business day ridership in 2018-2020 (thousand daily passengers).",
    x = NULL,
    y = "Passengers (thous.)",
    caption = "Fonte: ViaQuatro | Insper"
  )
```

## Working with Colors

The colors used in insperplot are based on Insper's [brandkit](https://github.com/Insper/Cores-Marca-Insper). There are

### Extracting Colors

Use `show_insper_colors()` to access Insper's brand colors.

```{r colors, eval = FALSE}
# Get primary Insper red
show_insper_colors("reds1")

# Get multiple colors
show_insper_colors("reds1", "teals1", "oranges1")

# View all available colors
show_insper_colors()
```

### Visualizing Palettes

```{r palette-viz, fig.height=4}
# Show all colors
show_insper_palette()

# Show specific color families
show_insper_palette("reds")
show_insper_palette("teals")
```

### Discovering Palettes

```{r palette-discovery}
# List all palettes with metadata
list_palettes()

# Interactive palette explorer
get_insper_colors("main")
```

## Plot Gallery: All 8 Functions

Now let's demonstrate each plotting function with the metro dataset.

### 1. Bar Plot: Monthly Ridership Comparison

Compare ridership across stations for a specific period using `insper_barplot()`:

```{r barplot}
# Compare average 2020 ridership by station (horizontal via coord_flip)
spo_metro |>
  filter(year == 2019) |>
  summarise()

spo_metro |>
  filter(year == 2020) |>
  summarise(avg_ridership = mean(value), .by = name_station) |>
  insper_barplot(
    x = name_station,
    y = avg_ridership,
    text = TRUE
  ) +
  coord_flip() +
  labs(
    title = "Demanda Média por Estação em 2020",
    subtitle = "Durante a pandemia de COVID-19",
    caption = "Fonte: CCR Metrô"
  )
```

### 2. Time Series: Station Trends Over Time

Track ridership trends with `insper_timeseries()`:

```{r timeseries}
# Compare 4 major stations over time
main_stations <- spo_metro |>
  mutate(rank = rank(-value, ties.method = "first"), .by = date) |>
  summarise(avg_rank = mean(rank), .by = name_station) |>
  slice_min(avg_rank, n = 4) |>
  pull(name_station)

main_metro <- subset(spo_metro, name_station %in% main_stations)

insper_timeseries(
  main_metro, date, value,
  group = name_station
) +
  labs(
    title = "Evolução da Demanda - Principais Estações",
    subtitle = "Linha 4-Amarela do Metrô de São Paulo (2018-2020)",
    caption = "Fonte: CCR Metrô | Insper",
    x = NULL,
    y = "Daily Passengers (thous.)",
    color = NULL
  )
```

### 5. Scatter Plot: Station Correlation

Explore relationships between stations with `insper_scatterplot()`:

```{r scatterplot}
# Compare Paulista vs Pinheiros ridership
paulista <- metro |>
  filter(name_station == "Paulista") |>
  select(date, paulista = value)

pinheiros <- metro |>
  filter(name_station == "Pinheiros") |>
  select(date, pinheiros = value)

inner_join(paulista, pinheiros, by = "date") |>
  insper_scatterplot(
    x = paulista,
    y = pinheiros,
    color = factor(format(date, "%Y")),
    add_smooth = TRUE
  ) +
  labs(
    title = "Correlação: Paulista vs Pinheiros",
    subtitle = "Demanda mensal (milhares), colorido por ano",
    caption = "Fonte: CCR Metrô | Insper"
  )
```

### 6. Box Plot: Distribution Analysis

Compare distributions across categories with `insper_boxplot()`:

```{r boxplot}
# Distribution of ridership by station (horizontal via coord_flip)
spo_metro |>
  insper_boxplot(
    x = name_station,
    y = value,
    fill = name_station,
    add_jitter = FALSE
  ) +
  coord_flip() +
  labs(
    title = "Distribuição de Demanda por Estação",
    subtitle = "Período: 2018-2020 (36 meses)",
    caption = "Fonte: CCR Metrô | Insper"
  )
```

## Brazilian Number Formatting

insperplot includes helpers for Brazilian locale formatting:

```{r formatting}
# Format large numbers in Brazilian style
large_numbers <- c(1234.56, 1234567.89, 0.1234)

# Note: format_br_number() is internal, but you can use scales package
library(scales)

# For axis labels in plots
ggplot(metro |> filter(name_station == "Paulista"),
       aes(x = date, y = value)) +
  geom_line(color = show_insper_colors("teals1"), linewidth = 1.2) +
  scale_y_continuous(labels = label_number(big.mark = ".", decimal.mark = ",")) +
  theme_insper() +
  labs(
    title = "Formatação Brasileira de Números",
    subtitle = "Usando scales::label_number() com padrão brasileiro",
    x = "Mês", y = "Passageiros (mil)",
    caption = "Fonte: CCR Metrô | Insper"
  )
```

## Saving Plots

Save plots in publication-ready formats:

```{r saving, eval=FALSE}
# Create a plot
p <- metro |>
  filter(name_station == "Paulista") |>
  insper_timeseries(
    x = date,
    y = value,
    title = "Estação Paulista - Linha 4"
  )

# Save as PNG (high resolution)
ggsave("paulista-ridership.png", p,
       width = 10, height = 6, dpi = 300)

# Save as PDF (vector graphics)
ggsave("paulista-ridership.pdf", p,
       width = 10, height = 6)

# Save as SVG (for web)
ggsave("paulista-ridership.svg", p,
       width = 10, height = 6)
```

**Recommended dimensions for common uses:**

- **Academic papers**: 7-10 inches width, 4-6 inches height, 300 dpi
- **Presentations**: 10-12 inches width, 6-7 inches height, 150 dpi
- **Posters**: 12-16 inches width, 8-10 inches height, 300 dpi
- **Web/dashboards**: 8-10 inches width, 5-6 inches height, 96-150 dpi

## Summary
