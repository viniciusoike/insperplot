# v0.3.0 - Documentation & Testing: Detailed Implementation Plan

## Overview
This phase focuses on comprehensive documentation, testing infrastructure, and ensuring all examples work correctly. Target: 80%+ code coverage with 0 errors, 0 warnings from `devtools::check()`.

---

## PHASE 1: Complete Documentation (Estimated: 1.5 hours)

### Step 1.1: Add @family Tags to All Functions

**Purpose:** Organize documentation by grouping related functions together in pkgdown.

**Actions:**
1. âœ… **Theme functions** - Add `@family themes` to:
   - `theme_insper()` âœ… (already done)

2. **Color functions** - Add `@family colors` to:
   - `insper_col()` âœ… (already done)
   - `insper_pal()` (in R/insper_palette.R)
   - `show_insper_palette()` (in R/utils.R)

3. **Scale functions** - Add `@family scales` to:
   - `scale_color_insper()` (in R/scales.R)
   - `scale_colour_insper()` (in R/scales.R)
   - `scale_fill_insper()` (in R/scales.R)

4. **Plot functions** - Add `@family plots` to:
   - `insper_barplot()` (in R/plots.R)
   - `insper_scatterplot()` (in R/plots.R)
   - `insper_timeseries()` (in R/plots.R)
   - `insper_boxplot()` (in R/plots.R)
   - `insper_heatmap()` (in R/plots.R)

5. **Utility functions** - Add `@family utilities` to:
   - `save_insper_plot()` (in R/utils.R)
   - `insper_caption()` (in R/utils.R)
   - `format_brl()` (in R/utils.R)
   - `format_percent_br()` (in R/utils.R)
   - `format_num_br()` (in R/utils.R)

**Validation:** Run `devtools::document()` and verify no warnings.

---

### Step 1.2: Create Package-Level Documentation

**Purpose:** Provide an overview when users run `?insperplot`.

**Actions:**
1. Create `R/insperplot-package.R` file with:
   - Package title and description
   - Link to main functions
   - Installation instructions
   - Basic usage example
   - Disclaimer about unofficial status
   - Reference to main website/GitHub

**Content structure:**
```r
#' @keywords internal
"_PACKAGE"

#' insperplot: Insper Themed ggplot2 Extensions
#'
#' @description
#' This package extends ggplot2 with Insper Instituto de Ensino e Pesquisa
#' visual identity...
#'
#' @section Main Functions:
#' - Theme: \code{\link{theme_insper}}
#' - Colors: \code{\link{insper_col}}, \code{\link{insper_pal}}
#' - Scales: \code{\link{scale_color_insper}}, \code{\link{scale_fill_insper}}
#' - Plots: \code{\link{insper_barplot}}, \code{\link{insper_scatterplot}}
#'
#' @section Disclaimer:
#' This is an unofficial package...
#'
#' @examples
#' ...
NULL
```

**Validation:** Run `?insperplot` after `devtools::document()`.

---

### Step 1.3: Improve Function Documentation

**Purpose:** Ensure all functions have complete, clear documentation.

**Actions:**
1. **Review insper_pal() documentation:**
   - Add more detailed examples
   - Document all available palette names
   - Add See Also section

2. **Review plot functions documentation:**
   - Ensure all parameters are documented
   - Add more comprehensive examples
   - Add notes about when to use each plot type

3. **Review utility functions:**
   - Ensure Brazilian formatting functions have locale examples
   - Add cross-references between related functions

**Validation:** Read through each help file, ensure clarity.

---

### Step 1.4: Add Cross-References

**Purpose:** Help users discover related functions.

**Actions:**
1. Add `@seealso` sections to:
   - `insper_col()` â†’ link to `insper_pal()`, `show_insper_palette()`
   - `insper_pal()` â†’ link to `insper_col()`, `scale_*_insper()`
   - `scale_*_insper()` â†’ link to `insper_pal()`
   - Plot functions â†’ link to `theme_insper()`, related plot functions

**Validation:** Verify links work in rendered documentation.

---

## PHASE 2: Testing Infrastructure (Estimated: 2 hours)

### Step 2.1: Set Up testthat Framework

**Purpose:** Initialize testing infrastructure.

**Actions:**
1. Run `usethis::use_testthat(3)` to:
   - Create `tests/testthat/` directory
   - Create `tests/testthat.R` file
   - Add testthat to Suggests in DESCRIPTION

2. Verify directory structure:
   ```
   tests/
   â”œâ”€â”€ testthat.R
   â””â”€â”€ testthat/
   ```

3. Create initial test file structure:
   - `tests/testthat/test-theme.R`
   - `tests/testthat/test-colors.R`
   - `tests/testthat/test-scales.R`
   - `tests/testthat/test-utilities.R`
   - `tests/testthat/test-plots.R`

**Validation:** Run `devtools::test()` - should show "No tests" or 0 tests initially.

---

### Step 2.2: Write Tests for theme_insper()

**File:** `tests/testthat/test-theme.R`

**Test cases to write:**

1. **Test: theme_insper() returns a theme object**
   ```r
   test_that("theme_insper returns a theme object", {
     theme <- theme_insper()
     expect_s3_class(theme, "theme")
     expect_s3_class(theme, "gg")
   })
   ```

2. **Test: theme_insper() accepts base_size parameter**
   ```r
   test_that("theme_insper accepts base_size", {
     expect_no_error(theme_insper(base_size = 10))
     expect_no_error(theme_insper(base_size = 14))
     expect_no_error(theme_insper(base_size = 18))
   })
   ```

3. **Test: theme_insper() grid parameter works**
   ```r
   test_that("theme_insper grid parameter works", {
     expect_no_error(theme_insper(grid = TRUE))
     expect_no_error(theme_insper(grid = FALSE))
     expect_error(theme_insper(grid = "yes"), "must be one of")
   })
   ```

4. **Test: theme_insper() border parameter validates correctly**
   ```r
   test_that("theme_insper border parameter validates", {
     expect_no_error(theme_insper(border = "none"))
     expect_no_error(theme_insper(border = "half"))
     expect_no_error(theme_insper(border = "closed"))
     expect_error(theme_insper(border = "invalid"), "must be one of")
   })
   ```

5. **Test: theme_insper() font parameters work**
   ```r
   test_that("theme_insper accepts font parameters", {
     expect_no_error(theme_insper(font_title = "Arial"))
     expect_no_error(theme_insper(font_text = "Helvetica"))
   })
   ```

**Validation:** Run `devtools::test()` - all theme tests should pass.

---

### Step 2.3: Write Tests for Color Functions

**File:** `tests/testthat/test-colors.R`

**Test cases to write:**

1. **Test: insper_col() returns colors**
   ```r
   test_that("insper_col returns all colors when no args", {
     cols <- insper_col()
     expect_type(cols, "character")
     expect_true(length(cols) > 0)
     expect_true(all(grepl("^#", cols)))
   })
   ```

2. **Test: insper_col() extracts specific colors**
   ```r
   test_that("insper_col can extract specific colors", {
     red <- insper_col("reds1")
     expect_length(red, 1)
     expect_equal(red, "#C4161C")
   })
   ```

3. **Test: insper_pal() returns palette**
   ```r
   test_that("insper_pal returns valid palettes", {
     pal <- insper_pal("main")
     expect_type(pal, "character")
     expect_true(all(grepl("^#", pal)))
   })
   ```

4. **Test: insper_pal() validates palette names**
   ```r
   test_that("insper_pal errors on invalid palette", {
     expect_error(insper_pal("invalid_palette"), "not found")
   })
   ```

5. **Test: insper_pal() reverse works**
   ```r
   test_that("insper_pal reverse parameter works", {
     pal_normal <- insper_pal("reds")
     pal_reverse <- insper_pal("reds", reverse = TRUE)
     expect_equal(pal_normal, rev(pal_reverse))
   })
   ```

6. **Test: insper_pal() continuous type works**
   ```r
   test_that("insper_pal continuous type interpolates", {
     pal <- insper_pal("reds", n = 10, type = "continuous")
     expect_length(pal, 10)
   })
   ```

7. **Test: show_insper_palette() creates plot**
   ```r
   test_that("show_insper_palette creates a ggplot", {
     p <- show_insper_palette()
     expect_s3_class(p, "ggplot")
   })
   ```

8. **Test: show_insper_palette() accepts palette names**
   ```r
   test_that("show_insper_palette works with palette names", {
     expect_s3_class(show_insper_palette("reds"), "ggplot")
     expect_s3_class(show_insper_palette("grays"), "ggplot")
   })
   ```

**Validation:** Run `devtools::test()` - all color tests should pass.

---

### Step 2.4: Write Tests for Scale Functions

**File:** `tests/testthat/test-scales.R`

**Test cases to write:**

1. **Test: scale_color_insper() returns scale object**
   ```r
   test_that("scale_color_insper returns discrete scale", {
     scale <- scale_color_insper()
     expect_s3_class(scale, "ScaleDiscrete")
   })
   ```

2. **Test: scale_color_insper() continuous mode**
   ```r
   test_that("scale_color_insper works with discrete=FALSE", {
     scale <- scale_color_insper(discrete = FALSE)
     expect_s3_class(scale, "Scale")
   })
   ```

3. **Test: scale_fill_insper() returns scale object**
   ```r
   test_that("scale_fill_insper returns discrete scale", {
     scale <- scale_fill_insper()
     expect_s3_class(scale, "ScaleDiscrete")
   })
   ```

4. **Test: scale_colour_insper() is alias**
   ```r
   test_that("scale_colour_insper is alias for scale_color_insper", {
     expect_identical(scale_colour_insper, scale_color_insper)
   })
   ```

5. **Test: scales accept palette parameter**
   ```r
   test_that("scales accept different palettes", {
     expect_no_error(scale_color_insper(palette = "reds"))
     expect_no_error(scale_fill_insper(palette = "bright"))
   })
   ```

6. **Test: scales accept reverse parameter**
   ```r
   test_that("scales accept reverse parameter", {
     expect_no_error(scale_color_insper(reverse = TRUE))
     expect_no_error(scale_fill_insper(reverse = FALSE))
   })
   ```

**Validation:** Run `devtools::test()` - all scale tests should pass.

---

### Step 2.5: Write Tests for Utility Functions

**File:** `tests/testthat/test-utilities.R`

**Test cases to write:**

1. **Test: format_brl() formats Brazilian currency**
   ```r
   test_that("format_brl formats currency correctly", {
     result <- format_brl(1234.56)
     expect_type(result, "character")
     expect_match(result, "R\\$")
     expect_match(result, "1\\.234,56")
   })
   ```

2. **Test: format_brl() symbol parameter**
   ```r
   test_that("format_brl symbol parameter works", {
     with_symbol <- format_brl(1000, symbol = TRUE)
     without_symbol <- format_brl(1000, symbol = FALSE)
     expect_match(with_symbol, "R\\$")
     expect_no_match(without_symbol, "R\\$")
   })
   ```

3. **Test: format_percent_br() formats percentages**
   ```r
   test_that("format_percent_br formats correctly", {
     result <- format_percent_br(0.1234)
     expect_type(result, "character")
     expect_match(result, "12,3%")
   })
   ```

4. **Test: format_num_br() formats numbers**
   ```r
   test_that("format_num_br uses Brazilian format", {
     result <- format_num_br(1234.56, digits = 2)
     expect_match(result, "1\\.234,56")
   })
   ```

5. **Test: insper_caption() builds caption**
   ```r
   test_that("insper_caption builds caption string", {
     caption <- insper_caption(text = "Test", source = "Data")
     expect_type(caption, "character")
     expect_match(caption, "Test")
     expect_match(caption, "Data")
   })
   ```

6. **Test: insper_caption() handles NULL inputs**
   ```r
   test_that("insper_caption handles NULL inputs", {
     expect_no_error(insper_caption(text = NULL))
     expect_no_error(insper_caption(source = NULL))
   })
   ```

7. **Test: insper_caption() date handling**
   ```r
   test_that("insper_caption formats date correctly", {
     date <- as.Date("2025-01-15")
     caption <- insper_caption(date = date)
     expect_match(caption, "Insper")
   })
   ```

8. **Test: insper_caption() language parameter**
   ```r
   test_that("insper_caption lang parameter works", {
     caption_pt <- insper_caption(source = "Test", lang = "pt")
     caption_en <- insper_caption(source = "Test", lang = "en")
     expect_match(caption_pt, "Fonte:")
     expect_match(caption_en, "Source:")
   })
   ```

9. **Test: save_insper_plot() parameters**
   ```r
   test_that("save_insper_plot accepts parameters", {
     skip_if_not_installed("ggplot2")
     p <- ggplot2::ggplot(mtcars, ggplot2::aes(x = wt, y = mpg)) +
       ggplot2::geom_point()
     temp_file <- tempfile(fileext = ".png")
     expect_no_error(save_insper_plot(p, temp_file))
     expect_true(file.exists(temp_file))
     unlink(temp_file)
   })
   ```

**Validation:** Run `devtools::test()` - all utility tests should pass.

---

### Step 2.6: Write Tests for Plot Functions

**File:** `tests/testthat/test-plots.R`

**Test cases to write:**

1. **Test: insper_barplot() returns ggplot**
   ```r
   test_that("insper_barplot returns ggplot object", {
     skip_if_not_installed("ggplot2")
     df <- data.frame(x = c("A", "B", "C"), y = c(1, 2, 3))
     p <- insper_barplot(df, x = x, y = y)
     expect_s3_class(p, "ggplot")
   })
   ```

2. **Test: insper_barplot() validates input**
   ```r
   test_that("insper_barplot validates data frame input", {
     expect_error(insper_barplot(list(), x = x, y = y), "data frame")
   })
   ```

3. **Test: insper_barplot() position parameter**
   ```r
   test_that("insper_barplot validates position parameter", {
     df <- data.frame(x = c("A", "B"), y = c(1, 2))
     expect_no_error(insper_barplot(df, x = x, y = y, position = "dodge"))
     expect_error(insper_barplot(df, x = x, y = y, position = "invalid"))
   })
   ```

4. **Test: insper_scatterplot() returns ggplot**
   ```r
   test_that("insper_scatterplot creates plot", {
     skip_if_not_installed("ggplot2")
     p <- insper_scatterplot(mtcars, x = wt, y = mpg)
     expect_s3_class(p, "ggplot")
   })
   ```

5. **Test: insper_timeseries() returns ggplot**
   ```r
   test_that("insper_timeseries creates plot", {
     skip_if_not_installed("ggplot2")
     df <- data.frame(time = 1:10, value = rnorm(10))
     p <- insper_timeseries(df, x = time, y = value)
     expect_s3_class(p, "ggplot")
   })
   ```

6. **Test: insper_boxplot() returns ggplot**
   ```r
   test_that("insper_boxplot creates plot", {
     skip_if_not_installed("ggplot2")
     p <- insper_boxplot(mtcars, x = factor(cyl), y = mpg)
     expect_s3_class(p, "ggplot")
   })
   ```

7. **Test: insper_heatmap() returns ggplot**
   ```r
   test_that("insper_heatmap creates plot", {
     skip_if_not_installed("ggplot2")
     mat <- cor(mtcars[, 1:4])
     p <- insper_heatmap(mat)
     expect_s3_class(p, "ggplot")
   })
   ```

**Validation:** Run `devtools::test()` - all plot tests should pass.

---

## PHASE 3: Examples & Data (Estimated: 45 minutes)

### Step 3.1: Review and Update All Examples

**Purpose:** Ensure all function examples run without errors.

**Actions:**

1. **Check each function's examples:**
   - Run `devtools::run_examples()` to test all examples
   - Fix any errors that appear
   - Ensure examples demonstrate key features

2. **Add `\donttest{}` where appropriate:**
   - For functions that create plots (may be slow)
   - For functions that save files
   - Keep simple examples without `\donttest{}`

3. **Ensure realistic examples:**
   - Use mtcars or built-in datasets
   - Show common use cases
   - Demonstrate parameter variations

**Validation:** `devtools::run_examples()` completes without errors.

---

### Step 3.2: Document Existing Dataset

**Purpose:** Document the metro_sp data if it should be included.

**Decision Point:**
- **Option A:** Keep metro_sp data and document it
- **Option B:** Remove it and create a new example dataset
- **Option C:** Remove it entirely (use only built-in R datasets)

**If keeping (Option A):**
1. Move CSV to proper location
2. Create R script to load and document data
3. Run `usethis::use_data()` to create .rda file
4. Write documentation in `R/data.R`

**If creating new (Option B):**
1. Create synthetic Brazilian economic/academic data
2. Document clearly
3. Use in examples

**If removing (Option C):**
1. Remove CSV file
2. Update examples to use mtcars, iris, etc.

**Validation:** Run `devtools::check()` - data section passes.

---

### Step 3.3: Add Example Vignette Stub (Optional)

**Purpose:** Prepare for v0.6.0 vignette creation.

**Actions:**
1. Create `vignettes/` directory structure (if not exists)
2. Add placeholder vignette files
3. Configure DESCRIPTION for vignettes

**Note:** Full vignette content comes in v0.6.0, but structure can be set up now.

**Validation:** Directory structure in place.

---

## PHASE 4: Validation & Quality Checks (Estimated: 30 minutes)

### Step 4.1: Run devtools::check()

**Purpose:** Ensure package passes all checks.

**Actions:**
1. Run `devtools::document()` to update documentation
2. Run `devtools::check()` in full
3. Address any errors, warnings, or notes
4. Verify: **0 errors âœ” | 0 warnings âœ” | 0 notes âœ”**

**Validation:** Clean check output.

---

### Step 4.2: Check Test Coverage

**Purpose:** Ensure we meet 80%+ coverage target.

**Actions:**
1. Install covr: `install.packages("covr")`
2. Run `covr::package_coverage()`
3. Review coverage report:
   ```r
   cov <- covr::package_coverage()
   print(cov)
   covr::report(cov)  # Opens browser with detailed report
   ```
4. Identify uncovered lines
5. Add tests for critical uncovered code
6. Re-run until 80%+ coverage achieved

**Validation:** Coverage â‰¥ 80%.

---

### Step 4.3: Spell Check

**Purpose:** Catch typos in documentation.

**Actions:**
1. Run `devtools::spell_check()`
2. Review flagged words
3. Add legitimate words to WORDLIST
4. Fix actual typos

**Validation:** No unexpected typos.

---

### Step 4.4: Code Quality Check (Optional but Recommended)

**Purpose:** Follow R package best practices.

**Actions:**
1. Install goodpractice: `install.packages("goodpractice")`
2. Run `goodpractice::gp()`
3. Review recommendations
4. Address critical issues
5. Document decisions to skip certain recommendations

**Validation:** Reasonable goodpractice score.

---

## PHASE 5: Documentation & Commit (Estimated: 15 minutes)

### Step 5.1: Update NEWS.md

**Purpose:** Document all changes in v0.3.0.

**Actions:**
1. Add v0.3.0 section to NEWS.md
2. List all documentation improvements
3. List all new tests
4. Note coverage percentage achieved
5. Mention any breaking changes (if any)

**Validation:** Clear, comprehensive changelog entry.

---

### Step 5.2: Update README if Needed

**Purpose:** Reflect any new features or examples.

**Actions:**
1. Review README.Rmd
2. Add any new notable features
3. Update examples if improved
4. Regenerate README.md: `devtools::build_readme()`

**Validation:** README is current and accurate.

---

### Step 5.3: Git Commit

**Purpose:** Save all v0.3.0 work.

**Actions:**
1. Stage all changes: `git add .`
2. Review changes: `git status`, `git diff --staged`
3. Commit with descriptive message:
   ```bash
   git commit -m "v0.3.0: Documentation & Testing complete

   Documentation improvements:
   - Added @family tags to all functions
   - Created package-level documentation
   - Improved cross-references
   - Enhanced function examples

   Testing:
   - Set up testthat framework
   - Added comprehensive test suite
   - Achieved XX% test coverage
   - All tests passing

   Validation:
   - devtools::check(): 0 errors, 0 warnings, 0 notes
   - spell_check: clean
   - goodpractice: passed

   ðŸ¤– Generated with Claude Code

   Co-Authored-By: Claude <noreply@anthropic.com>"
   ```

**Validation:** Clean commit, ready to push.

---

## Success Criteria for v0.3.0

At completion, the package must have:

- âœ… All functions documented with `@family` tags
- âœ… Package-level documentation (`?insperplot` works)
- âœ… testthat framework fully set up
- âœ… Test files for all major function groups
- âœ… **Test coverage â‰¥ 80%**
- âœ… **devtools::check()**: 0 errors, 0 warnings, 0 notes
- âœ… All examples run without errors
- âœ… Updated NEWS.md
- âœ… Clean git commit
- âœ… Ready to push to GitHub

---

## Estimated Time Breakdown

| Phase | Task | Time |
|-------|------|------|
| 1 | Complete Documentation | 1.5 hrs |
| 2 | Testing Infrastructure | 2.0 hrs |
| 3 | Examples & Data | 0.75 hrs |
| 4 | Validation & Quality | 0.5 hrs |
| 5 | Documentation & Commit | 0.25 hrs |
| **Total** | | **4-5 hrs** |

---

## Next Steps After v0.3.0

Once this phase is complete:
1. Push to GitHub
2. Verify GitHub Actions pass
3. Decide on v0.4.0 (Visual Identity Enhancement) or continue to v0.5.0
4. Celebrate excellent test coverage! ðŸŽ‰

---

Let's begin implementation! Ready to start with Phase 1?
